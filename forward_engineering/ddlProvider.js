"use strict";var ge=Object.defineProperty;var m=(T,f)=>ge(T,"name",{value:f,configurable:!0});var F=(T,f)=>()=>(f||T((f={exports:{}}).exports,f),f.exports);var te=F((Ye,ee)=>{"use strict";ee.exports={number:"NUMBER",string:"TEXT",date:"DATE",timestamp:"TIMESTAMP",binary:"BINARY",boolean:"BIT",document:"LONGTEXT",array:"LONGTEXT",objectId:"VARCHAR(24)",default:"CHAR"}});var ne=F((Be,re)=>{"use strict";re.exports={TINYINT:{capacity:1},SMALLINT:{capacity:2},MEDIUMINT:{capacity:3},INT:{capacity:4},INTEGER:{capacity:4},BIGINT:{capacity:8},INT1:{capacity:1},INT2:{capacity:2},INT3:{capacity:3},INT4:{capacity:4},INT8:{capacity:8},FLOAT:{capacity:4,mode:"floating"},DOUBLE:{capacity:8,mode:"floating"},"DOUBLE PRECISION":{capacity:8,mode:"floating"},REAL:{capacity:8,mode:"floating"},DECIMAL:{capacity:16,mode:"decimal"},DEC:{capacity:16,mode:"decimal"},NUMERIC:{capacity:16,mode:"decimal"},FIXED:{capacity:16,mode:"decimal"},NUMBER:{capacity:16,mode:"decimal"},CHAR:{size:1},VARCHAR:{mode:"varying"},TINYTEXT:{size:255,mode:"text"},TEXT:{size:65535,mode:"text"},MEDIUMTEXT:{size:16777215,mode:"text"},LONGTEXT:{size:4294967295,mode:"text"},JSON:{size:4294967295,mode:"text"},BINARY:{mode:"binary"},"CHAR BYTE":{mode:"binary"},VARBINARY:{size:2147483649,mode:"binary"},TINYBLOB:{size:255,mode:"binary"},BLOB:{size:65535,mode:"binary"},MEDIUMBLOB:{size:16777215,mode:"binary"},LONGBLOB:{size:4294967295,mode:"binary"},BIT:{mode:"boolean"},DATE:{format:"YYYY-MM-DD"},TIME:{format:"hh:mm:ss.nnnnnn"},DATETIME:{format:"YYYY-MM-DD hh:mm:ss"},TIMESTAMP:{format:"YYYY-MM-DD hh:mm:ss"},YEAR:{format:"YYYY"},ENUM:{mode:"enum"},SET:{mode:"enum"},GEOMETRY:{format:"euclidian",mode:"geospatial"},POINT:{format:"euclidian",mode:"geospatial"},LINESTRING:{format:"euclidian",mode:"geospatial"},POLYGON:{format:"euclidian",mode:"geospatial"},MULTIPOINT:{format:"euclidian",mode:"geospatial"},MULTILINESTRING:{format:"euclidian",mode:"geospatial"},MULTIPOLYGON:{format:"euclidian",mode:"geospatial"},GEOMETRYCOLLECTION:{format:"euclidian",mode:"geospatial"}}});var se=F((Ge,ie)=>{"use strict";ie.exports={createDatabase:"CREATE DATABASE${ifNotExist} `${name}`${dbOptions};\n",createTable:"CREATE ${temporary}TABLE ${ifNotExist}${name} (\n	${column_definitions}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n)${options}${partitions}${ignoreReplace}${selectStatement};\n",createLikeTable:"CREATE ${orReplace}${temporary}TABLE ${ifNotExist}${name} LIKE ${likeTableName};\n",columnDefinition:"`${name}` ${national}${type}${signed}${charset}${collate}${generatedDefaultValue}${primary_key}${unique_key}${default}${autoIncrement}${zeroFill}${not_null}${invisible}${compressed}${comment}",checkConstraint:"CONSTRAINT ${name}CHECK (${expression})${enforcement}",createForeignKeyConstraint:"CONSTRAINT `${name}` FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable}(${primaryKey})",createKeyConstraint:"${constraintName}${keyType}${columns}${using}${blockSize}${comment}${ignore}",createForeignKey:"ALTER TABLE ${foreignTable} ADD CONSTRAINT `${name}` FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable}(${primaryKey});",index:"CREATE ${indexType}INDEX ${name}${indexCategory}\n	ON ${table} ( ${keys} )${indexOptions};\n",createView:"CREATE ${orReplace}${algorithm}${sqlSecurity}VIEW ${ifNotExist}${name} AS ${selectStatement}${checkOption};\n",viewSelectStatement:"SELECT ${keys}\n	FROM ${tableName}",createFunction:"CREATE ${definer}FUNCTION ${ifNotExist}${name}\n	(${parameters})\n	RETURNS ${type}\n	${characteristics}\n${body} ${delimiter}\n",createProcedure:"CREATE ${definer}PROCEDURE ${ifNotExist}${name}\n(${parameters})\n	${characteristics}\n${body} ${delimiter}\n",alterView:"ALTER${algorithm}${sqlSecurity} VIEW ${name}\nAS ${selectStatement}${checkOption};",dropDatabase:"DROP DATABASE IF EXISTS `${name}`;",alterDatabaseCharset:"ALTER DATABASE `${name}` CHARACTER SET='${characterSet}' COLLATE='${collation}';",alterDatabaseEncryption:"ALTER DATABASE `${name}` ENCRYPTION='${encryption}';",dropUdf:"DROP FUNCTION IF EXISTS ${name};",dropProcedure:"DROP PROCEDURE IF EXISTS ${name};",dropTable:"DROP${temporary} TABLE IF EXISTS ${name};",alterTable:"ALTER TABLE ${table} ${alterStatement};",dropIndex:"DROP INDEX ${indexName}",dropCheckConstraint:"DROP CHECK ${name}",addCheckConstraint:"ADD ${checkConstraint}",alterCharset:"${default}CHARACTER SET='${charset}'${collation}",dropView:"DROP VIEW IF EXISTS ${viewName};",addColumn:"ADD COLUMN ${columnDefinition}",dropColumn:"DROP COLUMN ${name}",renameColumn:"RENAME COLUMN ${oldName} TO ${newName}",changeColumn:"CHANGE ${oldName} ${columnDefinition}",modifyColumn:"MODIFY ${columnDefinition}",createTableSpace:"CREATE${undo} TABLESPACE ${name} ADD DATAFILE ${file}${AUTOEXTEND_SIZE}${FILE_BLOCK_SIZE}${ENCRYPTION}${logFile}${EXTENT_SIZE}${INITIAL_SIZE}${ENGINE};"}});var ae=F((Fe,oe)=>{"use strict";var Ke=m(T=>Array.isArray(T)?T.reduce((f,U)=>({...f,[U.id]:U.value}),{}):{},"getAdditionalOptions");oe.exports=Ke});var Ee=F((xe,ce)=>{"use strict";var Pe=m(({commentIfDeactivated:T})=>(f,U)=>{let N=!1;return{...U,...["dropDatabase","dropUdf","dropProcedure","dropTable","dropColumn","dropIndex","dropCheckConstraint","dropView"].reduce((R,$)=>({...R,[$]:(...h)=>{let I=U[$](...h);return N=N||!!I,f||!I?I:T(I,{isActivated:!1})}}),{}),isDropInStatements(){return N}}},"dropStatementProxy");ce.exports=Pe});var le=F((Xe,me)=>{"use strict";me.exports=(T,f)=>{let U=m((n,a)=>`${n}(${a})`,"addLength"),N=m((n,a,g)=>T.isNumber(g)?`${n}(${a},${g})`:`${n}(${a})`,"addScalePrecision"),R=m((n,a)=>`${n}(${a})`,"addPrecision"),$=m(n=>["CHAR","VARCHAR","BINARY","CHAR BYTE","VARBINARY","BLOB"].includes(n),"canHaveLength"),h=m(n=>["TINYINT","SMALLINT","MEDIUMINT","INT","INTEGER","BIGINT","INT1","INT2","INT3","INT4","INT8","FLOAT","DOUBLE","REAL","DECIMAL","DEC","NUMERIC","FIXED","NUMBER","DOUBLE PRECISION","BIT"].includes(n),"isNumeric"),I=m(n=>h(n),"canHavePrecision"),_=m(n=>["TIME","DATETIME","TIMESTAMP"].includes(n),"canHaveMicrosecondPrecision"),L=m(n=>["DECIMAL","FLOAT","DOUBLE","DEC","FIXED","NUMERIC","NUMBER","DOUBLE PRECISION","REAL"].includes(n),"canHaveScale"),G=m((n,a)=>$(n)&&T.isNumber(a.length)?U(n,a.length):I(n)&&L(n)&&T.isNumber(a.precision)?N(n,a.precision,a.scale):I(n)&&T.isNumber(a.precision)?R(n,a.precision):_(n)&&T.isNumber(a.microSecPrecision)?R(n,a.microSecPrecision):["ENUM","SET"].includes(n)&&!T.isEmpty(a.enum)?`${n}('${a.enum.join("', '")}')`:n,"decorateType"),u=m(n=>["CHAR","VARCHAR","TEXT","TINYTEXT","MEDIUMTEXT","LONGTEXT"].includes(T.toUpper(n)),"isString"),l=m(n=>["TIME","DATE","DATETIME","TIMESTAMP"].includes(n),"isDateTime"),p=m(n=>T.trim(n).replace(/(\')+/g,"'$1"),"escapeQuotes");return{decorateType:G,decorateDefault:m((n,a)=>{let g=/^(null|current_timestamp(\(\d+\))?)(\s+on\s+update\s+current_timestamp(\(\d+\))?)?$/i;return(u(n)||l(n))&&!g.test(T.trim(a))?f(p(a)):a},"decorateDefault"),canBeNational:m(n=>["CHAR","VARCHAR"].includes(n),"canBeNational"),isNumeric:h,getSign:m((n,a)=>h(n)&&a===!1?" UNSIGNED":"","getSign"),createGeneratedColumn:m(n=>{if(!n||!n.expression)return"";let a=T.toUpper(n.generated_storage||"");return" "+[n.generatedType==="always"?"GENERATED ALWAYS":"",`AS (${n.expression})`,a].filter(Boolean).join(" ")},"createGeneratedColumn"),canHaveAutoIncrement:m(n=>["tinyint","smallint","mediumint","int","bigint"].includes(n),"canHaveAutoIncrement")}}});var de=F((Ze,Te)=>{"use strict";Te.exports=(T,f)=>{let U={ENGINE:"ENGINE",AUTO_INCREMENT:"AUTO_INCREMENT",AVG_ROW_LENGTH:"AVG_ROW_LENGTH",CHECKSUM:"CHECKSUM",DATA_DIRECTORY:"DATA DIRECTORY",DELAY_KEY_WRITE:"DELAY_KEY_WRITE",INDEX_DIRECTORY:"INDEX DIRECTORY",ENCRYPTED:"ENCRYPTED",ENCRYPTION_KEY_ID:"ENCRYPTION_KEY_ID",IETF_QUOTES:"IETF_QUOTES",INSERT_METHOD:"INSERT_METHOD",UNION:"UNION",KEY_BLOCK_SIZE:"KEY_BLOCK_SIZE",MIN_ROWS:"MIN_ROWS",MAX_ROWS:"MAX_ROWS",PACK_KEYS:"PACK_KEYS",PAGE_CHECKSUM:"PAGE_CHECKSUM",PAGE_COMPRESSED:"PAGE_COMPRESSED",PAGE_COMPRESSION_LEVEL:"PAGE_COMPRESSION_LEVEL",ROW_FORMAT:"ROW_FORMAT",SEQUENCE:"SEQUENCE",STATS_AUTO_RECALC:"STATS_AUTO_RECALC",STATS_PERSISTENT:"STATS_PERSISTENT",TRANSACTIONAL:"TRANSACTIONAL",compression:"COMPRESSION",STATS_SAMPLE_PAGES:"STATS_SAMPLE_PAGES",ENCRYPTION:"ENCRYPTION",AUTOEXTEND_SIZE:"AUTOEXTEND_SIZE",CONNECTION:"CONNECTION"},N={MyISAM:["AUTO_INCREMENT","AVG_ROW_LENGTH","CHECKSUM","DATA_DIRECTORY","DELAY_KEY_WRITE","INDEX_DIRECTORY","KEY_BLOCK_SIZE","PACK_KEYS","ROW_FORMAT"],InnoDB:["AUTO_INCREMENT","DATA_DIRECTORY","INDEX_DIRECTORY","ENCRYPTION","AUTOEXTEND_SIZE","ROW_FORMAT","compression","STATS_AUTO_RECALC","STATS_PERSISTENT","STATS_SAMPLE_PAGES","KEY_BLOCK_SIZE"],CSV:["KEY_BLOCK_SIZE"],MERGE:["INSERT_METHOD","UNION","KEY_BLOCK_SIZE"],Memory:["AUTO_INCREMENT","KEY_BLOCK_SIZE","MIN_ROWS","MAX_ROWS"],Archive:["AUTO_INCREMENT","KEY_BLOCK_SIZE"],Federated:["CONNECTION","KEY_BLOCK_SIZE"],EXAMPLE:[],BLACKHOLE:[],HEAP:["AUTO_INCREMENT","KEY_BLOCK_SIZE","MIN_ROWS","MAX_ROWS"],NDB:["KEY_BLOCK_SIZE"]},R=m((r,o)=>o?`\`${o}\`.\`${r}\``:`\`${r}\``,"getTableName"),$=m((r,o)=>{if(["ROW_FORMAT","INSERT_METHOD"].includes(r))return o?T.toUpper(o):void 0;if(r==="UNION")return o;if(["YES","NO","DEFAULT"].includes(T.toUpper(o)))return{YES:"'Y'",NO:"'N'"}[T.toUpper(o)]||T.toUpper(o);if(typeof o=="number")return o;if(!isNaN(+o)&&o)return+o;if(typeof o=="string"&&o)return f(o);if(typeof o=="boolean")return o?"'Y'":"'N'"},"getOptionValue"),h=m((r="")=>r.replace(/(?<!\\)('|"|`)/gi,"\\$1").replace(/\n/gi,"\\n"),"encodeStringLiteral"),I=m((r={})=>{let o=[],n=r.ENGINE;if(r.defaultCharSet||(r.characterSet&&o.push(`CHARSET=${r.characterSet}`),r.collation&&o.push(`COLLATE=${r.collation}`)),n&&o.push(`ENGINE = ${n}`),r.description&&o.push(`COMMENT = '${h(r.description)}'`),(N[n]||["KEY_BLOCK_SIZE"]).forEach(g=>{let X=$(g,r[g]);if(X===void 0)return;let q=`${U[g]} = ${X}`;o.push(q)}),["InnoDB","NDB"].includes(n)){let g="";r.TABLESPACE&&(g=`TABLESPACE ${r.TABLESPACE}`),n==="NDB"&&r.STORAGE&&(g+=` STORAGE ${r.STORAGE}`),g&&o.push(g.trim())}return o.length?" "+o.join(`,
	`):""},"getTableOptions"),_=m(r=>r?"LINEAR ":"","addLinear"),L=m(r=>{let o=` (${T.trim(r.partitioning_expression)})`,n="";return["RANGE","LIST"].includes(r.partitionType)&&r.partitioning_columns&&(o=` COLUMNS(${T.trim(r.partitioning_columns)})`),r.partitionType==="KEY"&&r.ALGORITHM&&(n=` ALGORITHM ${r.ALGORITHM}`),`${_(r.LINEAR)}${r.partitionType}${n}${o}`},"getPartitionBy"),G=m(r=>{if(!r.subpartitionType)return"";let o="";return r.subpartitionType==="KEY"&&r.SUBALGORITHM&&(o=` ALGORITHM ${r.SUBALGORITHM} `),`SUBPARTITION BY ${_(r.SUBLINEAR)}${r.subpartitionType}${o}(${T.trim(r.subpartitioning_expression)})`},"getSubPartitionBy"),u=m(r=>{if(!Array.isArray(r.partition_definitions))return"";let o=r.partition_definitions.filter(({partitionDefinition:n})=>n).map(n=>{let a=n.subpartitionDefinition;return a?n.partitionDefinition+" "+f(a,"(",")"):n.partitionDefinition}).join(`,
		`);return o?f(`
		`+o+`
	`,"(",")"):""},"getPartitionDefinitions"),l=m((r={})=>{if(!r.partitionType)return"";let o=`PARTITION BY ${L(r)}`,n=r.partitions?`PARTITIONS ${r.partitions}`:"",a=G(r),g=r.subpartitions?`SUBPARTITIONS ${r.subpartitions}`:"",X=u(r),q=[o,n,a,g,X].filter(Boolean);return q.length?`
	`+q.join(`
	`):""},"getPartitions"),p=m(r=>r?r.alias?`\`${r.name}\` as \`${r.alias}\``:`\`${r.name}\``:"","getKeyWithAlias"),b=m((r,o="")=>Array.isArray(r)?r.reduce((n,a)=>{if(!a.tableName)return n.columns.push(p(a)),n;let g=`\`${a.dbName||o}\`.\`${a.tableName}\``;return n.tables.includes(g)||n.tables.push(g),n.columns.push({statement:`${g}.${p(a)}`,isActivated:a.isActivated}),n},{tables:[],columns:[]}):{tables:[],columns:[]},"getViewData"),K=m(r=>{let o=[];return r.language&&o.push("LANGUAGE SQL"),r.deterministic&&o.push(r.deterministic),r.contains&&o.push(r.contains),r.sqlSecurity&&o.push(`SQL SECURITY ${r.sqlSecurity}`),r.comment&&o.push(`COMMENT ${f(E(r.comment))}`),o},"getCharacteristics"),E=m((r="")=>r.replace(/(')/gi,"'$1").replace(/\n/gi,"\\n"),"escapeQuotes");return{getTableName:R,getTableOptions:I,getPartitions:l,getViewData:b,getCharacteristics:K,escapeQuotes:E}}});var Ie=F((ke,Ne)=>{"use strict";Ne.exports=({_:T,commentIfDeactivated:f,checkAllKeysDeactivated:U,divideIntoActivatedAndDeactivated:N,assignTemplates:R,escapeQuotes:$})=>{let h=m((u,l)=>{var E,r;let p=f(((u==null?void 0:u.deactivatedItems)||[]).join(`,
	`),{isActivated:!l,isPartOfLine:!0}),b=(E=u==null?void 0:u.activatedItems)!=null&&E.length?`,
	`+u.activatedItems.join(`,
	`):"",K=(r=u==null?void 0:u.deactivatedItems)!=null&&r.length?`
	`+p:"";return b+K},"generateConstraintsString"),I=m(u=>{if(Array.isArray(u)){let l=u.filter(K=>T.get(K,"isActivated",!0)).map(K=>`\`${T.trim(K.name)}\``),p=u.filter(K=>!T.get(K,"isActivated",!0)).map(K=>`\`${T.trim(K.name)}\``),b=p.length?f(p,{isActivated:!1,isPartOfLine:!0}):"";return l.join(", ")+b}return u},"foreignKeysToString"),_=m(u=>u.map(l=>T.trim(l.name)).join(", "),"foreignActiveKeysToString"),L=m((u,l)=>p=>{let b=U(p.columns||[]),K=G(b,l,p.columns),E=p.category?` USING ${p.category}`:"",r=p.ignore?" IGNORED":"",o=p.comment?` COMMENT '${$(p.comment)}'`:"",n=p.blockSize?` KEY_BLOCK_SIZE=${p.blockSize}`:"";return{statement:R(u.createKeyConstraint,{constraintName:p.name?`CONSTRAINT \`${T.trim(p.name)}\` `:"",keyType:p.keyType,blockSize:n,columns:K,comment:o,ignore:r,using:E}),isActivated:!b}},"createKeyConstraint"),G=m((u,l,p)=>{var r;if(!p)return"";let b=m(({name:o,order:n})=>`\`${o}\` ${n}`.trim(),"columnMapToString"),K=N(p,b),E=(r=K==null?void 0:K.deactivatedItems)!=null&&r.length?f(K.deactivatedItems.join(", "),{isActivated:!1,isPartOfLine:!0}):"";return!u&&l?" ("+K.activatedItems.join(", ")+E+")":" ("+p.map(b).join(", ")+")"},"getKeyColumns");return{generateConstraintsString:h,foreignKeysToString:I,foreignActiveKeysToString:_,createKeyConstraint:L}}});var Ae=F((De,ue)=>{"use strict";ue.exports=(T,f)=>{let U=m((E,r)=>Object.entries(E.properties).map(r),"mapProperties"),N=m(E=>E.compositeUniqueKey?!1:!!E.unique,"isUniqueKey"),R=m(E=>{var r,o;return N(E)&&(((r=E.uniqueKeyOptions)==null?void 0:r.length)===1&&!((o=T.first(E.uniqueKeyOptions))!=null&&o.constraintName)||T.isEmpty(E.uniqueKeyOptions))},"isInlineUnique"),$=m(E=>E.compositeUniqueKey||E.compositePrimaryKey?!1:!!E.primaryKey,"isPrimaryKey"),h=m(E=>{var r;return $(E)&&!((r=E.primaryKeyOptions)!=null&&r.constraintName)},"isInlinePrimaryKey"),I=m(E=>T.toLower(E)==="asc"?"ASC":T.toLower(E)==="desc"?"DESC":"","getOrder"),_=m((E,r,o)=>f({keyType:"UNIQUE",name:E.constraintName,columns:[{name:r,order:I(E.order||E.indexOrder),isActivated:o}],category:E.indexCategory,ignore:E.indexIgnore,comment:E.indexComment,blockSize:E.indexBlockSize}),"hydrateUniqueOptions"),L=m((E,r,o)=>f({keyType:"PRIMARY KEY",name:E.constraintName,columns:[{name:r,order:I(E.order||E.indexOrder),isActivated:o}],category:E.indexCategory,ignore:E.indexIgnore,comment:E.indexComment,blockSize:E.indexBlockSize}),"hydratePrimaryKeyOptions"),G=m((E,r)=>Object.keys(r).find(o=>r[o].GUID===E),"findName"),u=m((E,r)=>T.get(Object.values(r).find(o=>o.GUID===E),"isActivated",!0),"checkIfActivated"),l=m((E,r)=>E.map(o=>({name:G(o.keyId,r.properties),order:{descending:"DESC",ascending:"ASC"}[o.type]||"",isActivated:u(o.keyId,r.properties)})),"getKeys"),p=m(E=>Array.isArray(E.primaryKey)?E.primaryKey.filter(r=>!T.isEmpty(r.compositePrimaryKey)).map(r=>({...L(r),columns:l(r.compositePrimaryKey,E)})):[],"getCompositePrimaryKeys"),b=m(E=>Array.isArray(E.uniqueKey)?E.uniqueKey.filter(r=>!T.isEmpty(r.compositeUniqueKey)).map(r=>({..._(r),columns:l(r.compositeUniqueKey,E)})):[],"getCompositeUniqueKeys");return{getTableKeyConstraints:m(({jsonSchema:E})=>{if(!E.properties)return[];let r=U(E,([n,a])=>{if(!(!$(a)||h(a)))return L(a.primaryKeyOptions,n,a.isActivated)}).filter(Boolean),o=T.flatten(U(E,([n,a])=>!N(a)||R(a)?[]:(a.uniqueKeyOptions||[]).map(g=>_(g,n,a.isActivated)))).filter(Boolean);return[...r,...p(E),...o,...b(E)]},"getTableKeyConstraints"),isInlineUnique:R,isInlinePrimaryKey:h,hydratePrimaryKeyOptions:L,hydrateUniqueOptions:_}}});var ye=F((ze,pe)=>{"use strict";pe.exports=T=>{let f=m((R,$)=>{var _,L,G;let h=m(u=>/\[\d*\]/.test(u),"isArrayItem"),I=$;for(let u=0;u<R.length;u++){let l=R[u];if(!I)return;h(l)?Array.isArray(I.items)?I=I.items[+((_=l.match(/\[(\d*)\]/))==null?void 0:_[1])||0]:I=I.items:(L=I.properties)!=null&&L[l]&&(I=(G=I.properties)==null?void 0:G[l])}return I},"findProperty"),U=m(R=>R.type==="jsonArray"?"UNSIGNED ARRAY":R.type==="jsonNumber"?"DECIMAL(5,2)":`CHAR(${R.maxLength||R.minLength||50})`,"getCastingTypeBySchema");return{processIndexKeyName:m(({name:R,type:$,jsonSchema:h})=>{let I=R.split(".");if(I.length<=1)return`\`${R}\`${$==="DESC"?" DESC":""}`;let _=f(I,h);return _?`(CAST(${T(I[0],"`","`")}->'$.${I.slice(1).join(".")}' AS ${U(_)}))`:`\`${R}\`${$==="DESC"?" DESC":""}`},"processIndexKeyName")}}});var Ue=te(),Oe=ne(),d=se(),_e=ae(),be=Ee();module.exports=(T,f,U)=>{let N=U.require("lodash"),{tab:R,commentIfDeactivated:$,checkAllKeysDeactivated:h,divideIntoActivatedAndDeactivated:I,hasType:_,wrap:L,clean:G,getDifferentProperties:u}=U.require("@hackolade/ddl-fe-utils").general,{assignTemplates:l,compareGroupItems:p}=U.require("@hackolade/ddl-fe-utils"),{decorateDefault:b,decorateType:K,canBeNational:E,getSign:r,createGeneratedColumn:o,canHaveAutoIncrement:n}=le()(N,L),{getTableName:a,getTableOptions:g,getPartitions:X,getViewData:q,getCharacteristics:z,escapeQuotes:w}=de()(N,L),{generateConstraintsString:Q,foreignKeysToString:k,foreignActiveKeysToString:j,createKeyConstraint:D}=Ie()({_:N,commentIfDeactivated:$,checkAllKeysDeactivated:h,divideIntoActivatedAndDeactivated:I,assignTemplates:l,escapeQuotes:w}),Z=Ae()(N,G),{processIndexKeyName:Se}=ye()(L),J=_e(f.additionalOptions);return be({commentIfDeactivated:$})(J.applyDropStatements,{createDatabase({databaseName:e,ifNotExist:t,collation:i,characterSet:c,encryption:s,udfs:O,procedures:S,tablespaces:y,useDb:P=!0}){let C="";C+=c?R(`
CHARACTER SET = '${c}'`):"",C+=i?R(`
COLLATE = '${i}'`):"",C+=s?R(`
ENCRYPTION = 'Y'`):"";let Y=l(d.createDatabase,{name:e,ifNotExist:t?" IF NOT EXISTS":"",dbOptions:C,useDb:P?`USE \`${e}\`;
`:""}),A=O.map(M=>this.createUdf(e,M)),B=S.map(M=>this.createProcedure(e,M));return[...y.map(M=>this.createTableSpace(M)).filter(Boolean),Y,...A,...B].join(`
`)},dropDatabase(e){return l(d.dropDatabase,e)},alterDatabase(e){var c,s,O,S,y,P,C,Y;let t=[],i=e.name;return J.excludeContainerAlterStatements?"":((e.collation||e.characterSet)&&t.push(l(d.alterDatabaseCharset,{name:i,characterSet:e.characterSet,collation:e.collation})),e.encryption&&t.push(l(d.alterDatabaseEncryption,{name:i,encryption:e.encryption})),N.isEmpty((c=e.udfs)==null?void 0:c.deleted)||(s=e.udfs)==null||s.deleted.forEach(A=>{t.push(this.dropUdf(i,A))}),N.isEmpty((O=e.udfs)==null?void 0:O.added)||e.udfs.added.forEach(A=>{t.push(this.createUdf(i,A))}),N.isEmpty((S=e.udfs)==null?void 0:S.modified)||e.udfs.modified.forEach(A=>{t.push(this.dropUdf(i,A.old)+`
`+this.createUdf(i,A.new))}),N.isEmpty((y=e.procedures)==null?void 0:y.deleted)||(P=e.procedures)==null||P.deleted.forEach(A=>{t.push(this.dropProcedure(i,A))}),N.isEmpty((C=e.procedures)==null?void 0:C.added)||e.procedures.added.forEach(A=>{t.push(this.createProcedure(i,A))}),N.isEmpty((Y=e.procedures)==null?void 0:Y.modified)||e.procedures.modified.forEach(A=>{t.push(this.dropProcedure(i,A.old)+`
`+this.createProcedure(i,A.new))}),t.join(`

`))},createTableSpace(e){if(!e.name||!e.DATAFILE||e.ENGINE==="NDB"&&!e.LOGFILE_GROUP)return"";let t="";return e.ENGINE==="NDB"?t=l(d.createTableSpace,{undo:e.UNDO?" UNDO":"",name:e.name,file:L(e.DATAFILE,"'","'"),AUTOEXTEND_SIZE:e.AUTOEXTEND_SIZE?` AUTOEXTEND_SIZE=${e.AUTOEXTEND_SIZE}`:"",logFile:` USE LOGFILE GROUP ${e.LOGFILE_GROUP}`,EXTENT_SIZE:e.EXTENT_SIZE?` EXTENT_SIZE=${e.EXTENT_SIZE}`:"",INITIAL_SIZE:e.INITIAL_SIZE?` INITIAL_SIZE=${e.INITIAL_SIZE}`:"",ENGINE:" ENGINE=NDB"}):t=l(d.createTableSpace,{undo:e.UNDO?" UNDO":"",name:e.name,file:L(e.DATAFILE,"'","'"),AUTOEXTEND_SIZE:e.AUTOEXTEND_SIZE?` AUTOEXTEND_SIZE=${e.AUTOEXTEND_SIZE}`:"",FILE_BLOCK_SIZE:e.FILE_BLOCK_SIZE?` FILE_BLOCK_SIZE=${e.FILE_BLOCK_SIZE}`:"",ENCRYPTION:e.ENCRYPTION?` ENCRYPTION=${e.ENCRYPTION}`:"",ENGINE:" ENGINE=InnoDB"}),$(t,{isActivated:e.isActivated})+`
`},createUdf(e,t){let i=z(t.characteristics),c=t.delimiter?`DELIMITER ${t.delimiter}
`:"",s=t.delimiter?`DELIMITER ;
`:"";return c+l(d.createFunction,{name:a(t.name,e),definer:t.definer?`DEFINER=${t.definer} `:"",ifNotExist:t.ifNotExist?"IF NOT EXISTS ":"",characteristics:i.join(`
	`),type:t.type,parameters:t.parameters,body:t.body,delimiter:t.delimiter||";"})+s},createProcedure(e,t){let i=z(t.characteristics),c=t.delimiter?`DELIMITER ${t.delimiter}
`:"",s=t.delimiter?`DELIMITER ;
`:"";return c+l(d.createProcedure,{name:a(t.name,e),ifNotExist:t.ifNotExist?"IF NOT EXISTS ":"",definer:t.definer?`DEFINER=${t.definer} `:"",parameters:t.parameters,characteristics:i.join(`
	`),body:t.body,delimiter:t.delimiter||";"})+s},dropUdf(e,t){return l(d.dropUdf,{name:a(t.name,e)})},dropProcedure(e,t){return l(d.dropProcedure,{name:a(t.name,e)})},createTable({name:e,columns:t,dbData:i,temporary:c,ifNotExist:s,likeTableName:O,selectStatement:S,options:y,partitioning:P,checkConstraints:C,foreignKeyConstraints:Y,keyConstraints:A,selectIgnore:B,selectReplace:v},M){let x=a(e,i.databaseName),H=c?"TEMPORARY ":"",V=s?"IF NOT EXISTS ":"";if(O)return $(l(d.createLikeTable,{name:x,likeTableName:a(O,i.databaseName),temporary:H,ifNotExist:V}),{isActivated:M});let Ce=I(A.map(D(d,M)),W=>W.statement),fe=Q(Ce,M),Re=I(Y,W=>W.statement),$e=Q(Re,M),Le=S?B?" IGNORE":v?" REPLACE":"":"",he=l(d.createTable,{name:x,column_definitions:t.join(`,
	`),selectStatement:S?` AS ${S}`:"",temporary:H,ifNotExist:V,options:g(y),partitions:X(P),checkConstraints:C.length?`,
	`+C.join(`,
	`):"",foreignKeyConstraints:$e,keyConstraints:fe,ignoreReplace:Le});return $(he,{isActivated:M})},dropTable({name:e,dbName:t,temporary:i}){return l(d.dropTable,{name:a(e,t),temporary:i?" TEMPORARY":""})},alterTable({name:e,collationOptions:t},i){let c=a(e,i.databaseName);return t?l(d.alterTable,{table:c,alterStatement:l(d.alterCharset,{charset:t.characterSet,default:t.defaultCharSet?"DEFAULT ":"",collation:t.collation?` COLLATE='${t.collation}'`:""})}):""},convertColumnDefinition(e){let t=N.toUpper(e.type),i=e.nullable?"":" NOT NULL",c=e.primaryKey?" "+D(d,!0)(e.primaryKeyOptions).statement:"",s=e.unique?" "+D(d,!0)(e.uniqueKeyOptions).statement:"",O=e.zerofill?" ZEROFILL":"",S=e.autoIncrement?" AUTO_INCREMENT":"",y=e.invisible?" INVISIBLE":"",P=e.national&&E(t)?"NATIONAL ":"",C=e.comment?` COMMENT '${w(e.comment)}'`:"",Y=t!=="JSON"&&e.charset?` CHARSET ${e.charset}`:"",A=t!=="JSON"&&e.charset&&e.collation?` COLLATE ${e.collation}`:"",B=o(e.generatedDefaultValue),v=!N.isUndefined(e.default)&&!B?" DEFAULT "+b(t,e.default):"",M=e.compressionMethod?` COMPRESSED=${e.compressionMethod}`:"",x=r(t,e.signed);return $(l(d.columnDefinition,{name:e.name,type:K(t,e),not_null:i,primary_key:c,unique_key:s,default:v,generatedDefaultValue:B,autoIncrement:S,compressed:M,signed:x,zeroFill:O,invisible:y,comment:C,national:P,charset:Y,collate:A}),{isActivated:e.isActivated})},addColumn(e,t,i){let c=a(e,i.databaseName);return l(d.alterTable,{table:c,alterStatement:l(d.addColumn,{columnDefinition:this.convertColumnDefinition(t)})})},dropColumn(e,t,i){let c=a(e,i.databaseName);return l(d.alterTable,{table:c,alterStatement:l(d.dropColumn,{name:L(t.name,"`","`")})})},alterColumn(e,t,i){let c=a(e,i.databaseName),s="";return t.oldName&&!t.newOptions?s=l(d.renameColumn,{oldName:L(t.oldName,"`","`"),newName:L(t.name,"`","`")}):t.oldName&&t.newOptions?s=l(d.changeColumn,{oldName:L(t.oldName,"`","`"),columnDefinition:this.convertColumnDefinition({...t,isActivated:!0})}):s=l(d.modifyColumn,{columnDefinition:this.convertColumnDefinition({...t,isActivated:!0})}),$(l(d.alterTable,{table:c,alterStatement:s}),{isActivated:t.isActivated})},createIndex(e,t,i,c=!0,s){if(N.isEmpty(t.indxKey)&&N.isEmpty(t.indxExpression)||!t.indxName)return"";let O=h(t.indxKey||[]),S=t.isActivated===!1||!c||O,y=t.indexType&&N.toUpper(t.indexType)!=="KEY"?`${N.toUpper(t.indexType)} `:"",P=L(t.indxName||"","`","`"),C=a(e,i.databaseName),Y=t.indexCategory?` USING ${t.indexCategory}`:"",A=[],B=I(t.indxKey||[],H=>Se({name:H.name,type:H.type,jsonSchema:s})),v=B.deactivatedItems.length?$(B.deactivatedItems.join(", "),{isActivated:S,isPartOfLine:!0}):"",M=(t.indxExpression||[]).map(H=>{var V;return(V=H.value)==null?void 0:V.replace(/\\/g,"\\\\")}).filter(Boolean);t.indxKeyBlockSize&&A.push(`KEY_BLOCK_SIZE = ${t.indxKeyBlockSize}`),t.indexType==="FULLTEXT"&&t.indxParser&&A.push(`WITH PARSER ${t.indxParser}`),t.indexComment&&A.push(`COMMENT '${w(t.indexComment)}'`),t.indxVisibility&&A.push(t.indxVisibility),t.indexLock?A.push(`LOCK ${t.indexLock}`):t.indexAlgorithm&&A.push(`ALGORITHM ${t.indexAlgorithm}`);let x=l(d.index,{keys:M.length?`${M.join(", ")}`:B.activatedItems.join(", ")+(S&&v&&B.activatedItems.length?", "+v:v),indexOptions:A.length?`
	`+A.join(`
	`):"",name:P,table:C,indexType:y,indexCategory:Y});return S?$(x,{isActivated:!1}):x},dropIndex(e,t,i){if(!t.indxName)return"";let c=a(e,i.databaseName),s=L(t.indxName,"`","`");return l(d.alterTable,{table:c,alterStatement:l(d.dropIndex,{indexName:s})})},alterIndex(e,{new:t,old:i},c){return[this.dropIndex(e,i,c),this.createIndex(e,{...t,indxKey:t.indxKey.filter(s=>s.isActivated!==!1)},c)].join(`
`)},createCheckConstraint(e){return l(d.checkConstraint,{name:e.name?`${L(e.name,"`","`")} `:"",expression:N.trim(e.expression).replace(/^\(([\s\S]*)\)$/,"$1"),enforcement:e.enforcement?` ${e.enforcement}`:""})},createCheckConstraintStatement(e,t,i){let c=a(e,i.databaseName);return l(d.alterTable,{table:c,alterStatement:l(d.addCheckConstraint,{checkConstraint:this.createCheckConstraint(t)})})},dropCheckConstraint(e,t,i){let c=a(e,i.databaseName);return l(d.alterTable,{table:c,alterStatement:l(d.dropCheckConstraint,{name:L(t.name,"`","`")})})},alterCheckConstraint(e,{new:t,old:i},c){return[this.dropCheckConstraint(e,i,c),this.createCheckConstraintStatement(e,t,c)].join(`
`)},createForeignKeyConstraint({name:e,foreignKey:t,primaryTable:i,primaryKey:c,primaryTableActivated:s,foreignTableActivated:O},S){let y=h(c),P=h(t),C=!y&&!P&&s&&O;return{statement:l(d.createForeignKeyConstraint,{primaryTable:a(i,S.databaseName),name:e,foreignKey:C?k(t):j(t),primaryKey:C?k(c):j(c)}),isActivated:C}},createForeignKey({name:e,foreignTable:t,foreignKey:i,primaryTable:c,primaryKey:s,primaryTableActivated:O,foreignTableActivated:S},y){let P=h(s),C=h(i);return{statement:l(d.createForeignKey,{primaryTable:a(c,y.databaseName),foreignTable:a(t,y.databaseName),name:e,foreignKey:k(i),primaryKey:k(s)}),isActivated:!P&&!C&&O&&S}},createView(e,t,i){let{deactivatedWholeStatement:c,selectStatement:s}=this.viewSelectStatement(e,i,t),O=e.algorithm&&e.algorithm!=="UNDEFINED"?`ALGORITHM=${e.algorithm} `:"";return $(l(d.createView,{name:a(e.name,t.databaseName),orReplace:e.orReplace?"OR REPLACE ":"",ifNotExist:e.ifNotExist?"IF NOT EXISTS ":"",sqlSecurity:e.sqlSecurity?`SQL SECURITY ${e.sqlSecurity} `:"",checkOption:e.checkOption?`
WITH ${e.checkOption} CHECK OPTION`:"",selectStatement:s,algorithm:O}),{isActivated:!c})},viewSelectStatement(e,t=!0,i){let s=h(e.keys||[])||!t,{columns:O,tables:S}=q(e.keys,i.databaseName),y=O.map(C=>C.statement).join(`,
		`);if(!s){let C=I(O,A=>A.statement),Y=C.deactivatedItems.length?$(C.deactivatedItems.join(`,
		`),{isActivated:!1,isPartOfLine:!0}):"";y=C.activatedItems.join(`,
		`)+Y}let P=N.trim(e.selectStatement)?N.trim(R(e.selectStatement)):l(d.viewSelectStatement,{tableName:S.join(", "),keys:y});return{deactivatedWholeStatement:s,selectStatement:P}},dropView({name:e,dbData:t}){let i=a(e,t.databaseName);return l(d.dropView,{viewName:i})},alterView(e,t){if(N.isEmpty(e.options))return"";let i=a(e.name,t.databaseName),{selectStatement:c}=this.viewSelectStatement(e,!0,t),s=e.options||{};return l(d.alterView,{name:i,selectStatement:c,algorithm:s.algorithm&&s.algorithm!=="UNDEFINED"?` ALGORITHM=${s.algorithm}`:"",sqlSecurity:s.sqlSecurity?` SQL SECURITY ${s.sqlSecurity}`:"",checkOption:s.checkOption?`
WITH ${s.checkOption} CHECK OPTION`:""})},createViewIndex(e,t,i,c){return""},createUdt(e,t){return""},getDefaultType(e){return Ue[e]},getTypesDescriptors(){return Oe},hasType(e){return _(Oe,e)},hydrateColumn({columnDefinition:e,jsonSchema:t,dbData:i}){return{name:e.name,type:e.type,primaryKey:Z.isInlinePrimaryKey(t),primaryKeyOptions:N.omit(Z.hydratePrimaryKeyOptions(t.primaryKeyOptions||{}),"columns"),unique:Z.isInlineUnique(t),uniqueKeyOptions:N.omit(Z.hydrateUniqueOptions(N.first(t.uniqueKeyOptions)||{}),"columns"),nullable:e.nullable,default:e.default,comment:e.description||t.refDescription||t.description,isActivated:e.isActivated,scale:e.scale,precision:e.precision,length:e.length,national:t.national,zerofill:t.zerofill,invisible:t.invisible,compressionMethod:t.compressed?t.compression_method:"",enum:t.enum,synonym:t.synonym,signed:t.zerofill||t.signed,microSecPrecision:t.microSecPrecision,charset:t.characterSet,collation:t.collation,generatedDefaultValue:t.generatedDefaultValue,...n(e.type)&&{autoIncrement:t.autoincrement}}},hydrateDropColumn({name:e}){return{name:e}},hydrateAlterColumn({newColumn:e,oldColumn:t,newColumnSchema:i,oldColumnSchema:c,oldCompData:s,newCompData:O}){let S=u(e,t,["name","type"]),y={...e};return s.name!==O.name&&(y.oldName=s.name),s.type!==O.type&&(y.oldType=s.type),N.isEmpty(S)||(y.newOptions=S),y},hydrateIndex(e,t){var i,c;return{indxName:(e==null?void 0:e.indxName)||"",indxKey:(i=e==null?void 0:e.indxKey)==null?void 0:i.map(s=>({name:s.name,type:s.type,isActivated:s.isActivated})),indxExpression:(c=e==null?void 0:e.indxExpression)==null?void 0:c.map(s=>({value:s.value})),isActivated:e==null?void 0:e.isActivated,indexType:e==null?void 0:e.indexType,indexCategory:e==null?void 0:e.indexCategory,indxKeyBlockSize:e==null?void 0:e.indxKeyBlockSize,indxParser:e==null?void 0:e.indxParser,indexComment:e==null?void 0:e.indexComment,indxVisibility:e==null?void 0:e.indxVisibility,indexLock:e==null?void 0:e.indexLock,indexAlgorithm:e==null?void 0:e.indexAlgorithm}},hydrateViewIndex(e){return{}},hydrateCheckConstraint(e){return{name:e.chkConstrName,expression:e.constrExpression,enforcement:e.constrEnforcement}},hydrateDatabase(e,t){var i,c;return{databaseName:e.name,ifNotExist:e.ifNotExist,characterSet:e.characterSet,collation:e.collation,encryption:e.ENCRYPTION==="Yes",udfs:((t==null?void 0:t.udfs)||[]).map(this.hydrateUdf),procedures:((t==null?void 0:t.procedures)||[]).map(this.hydrateProcedure),tablespaces:(((c=(i=t==null?void 0:t.modelData)==null?void 0:i[2])==null?void 0:c.tablespaces)||[]).map(this.hydrateTableSpace)}},hydrateTableSpace(e){return{name:e.name,isActivated:e.isActivated,DATAFILE:e.DATAFILE,UNDO:e.UNDO,AUTOEXTEND_SIZE:e.AUTOEXTEND_SIZE,ENGINE:e.ENGINE,FILE_BLOCK_SIZE:e.UNDO?"":e.FILE_BLOCK_SIZE,ENCRYPTION:{Yes:"Y",No:"N"}[e.ENCRYPTION]||"",LOGFILE_GROUP:e.LOGFILE_GROUP,EXTENT_SIZE:e.EXTENT_SIZE,INITIAL_SIZE:e.INITIAL_SIZE}},hydrateTable({tableData:e,entityData:t,jsonSchema:i}){let c=t[0],s=N.get(e,`relatedSchemas[${c.like}]`,"");return{...e,keyConstraints:Z.getTableKeyConstraints({jsonSchema:i}),temporary:c.temporary,ifNotExist:!c.orReplace&&c.ifNotExist,likeTableName:(s==null?void 0:s.code)||(s==null?void 0:s.collectionName),selectStatement:N.trim(c.selectStatement),options:{...c.tableOptions,description:c.description},partitioning:c.partitioning,selectIgnore:c.selectIgnore,selectReplace:c.selectReplace}},hydrateDropTable({tableData:e,entityData:t}){let i=t[0];return{name:e.name,dbName:e.dbData.databaseName,temporary:i==null?void 0:i.temporary}},hydrateViewColumn(e){return{name:e.name,tableName:e.entityName,alias:e.alias,isActivated:e.isActivated,dbName:e.dbName}},hydrateView({viewData:e,entityData:t,relatedSchemas:i,relatedContainers:c}){let s=t[0];return{name:e.name,keys:e.keys,orReplace:s.orReplace,ifNotExist:s.ifNotExist,selectStatement:s.selectStatement,sqlSecurity:s.SQL_SECURITY,algorithm:s.algorithm,checkOption:s.withCheckOption?s.checkTestingScope:""}},hydrateDropView({tableData:e}){return{name:e.name,dbData:e.dbData}},hydrateAlterView({name:e,newEntityData:t,oldEntityData:i,viewData:c,jsonSchema:s}){var P;let O=this.hydrateView({viewData:{},entityData:t}),S=this.hydrateView({viewData:{},entityData:i}),y=u(O,S);return{name:e,keys:c.keys,selectStatement:y.selectStatement||((P=t[0])==null?void 0:P.selectStatement),options:y}},commentIfDeactivated(e,t,i){return e},hydrateUdf(e){return{name:e.name,delimiter:e.functionDelimiter,ifNotExist:e.functionIfNotExist,definer:e.functionDefiner,parameters:e.functionArguments,type:e.functionReturnType,characteristics:{sqlSecurity:e.functionSqlSecurity,language:e.functionLanguage,contains:e.functionContains,deterministic:e.functionDeterministic,comment:e.functionDescription},body:e.functionBody}},hydrateProcedure(e){return{delimiter:e.delimiter,definer:e.definer,ifNotExist:e.procedureIfNotExist,name:e.name,parameters:e.inputArgs,body:e.body,characteristics:{comment:e.comments,contains:e.contains,language:e.language,deterministic:e.deterministic,sqlSecurity:e.securityMode}}},hydrateDropDatabase(e){var t;return{name:((t=e[0])==null?void 0:t.name)||""}},hydrateAlterDatabase({containerData:e,compModeData:t}){let i=e[0]||{},c=t.new.characterSet!==t.old.characterSet,s=t.new.collation!==t.old.collation,O=t.new.ENCRYPTION!==t.old.ENCRYPTION,S=p((t.old.Procedures||[]).map(this.hydrateProcedure),(t.new.Procedures||[]).map(this.hydrateProcedure)),y=p((t.old.UDFs||[]).map(this.hydrateUdf),(t.new.UDFs||[]).map(this.hydrateUdf));return{name:i.name||"",...c||s?{characterSet:i.characterSet,collation:i.collation}:{},...O?{encryption:i.ENCRYPTION==="Yes"?"Y":"N"}:{},procedures:S,udfs:y}},hydrateAlterTable({name:e,newEntityData:t,oldEntityData:i,jsonSchema:c}){var y,P,C;let s=t[0],O=i[0],S=["defaultCharSet","characterSet","collation"].some(Y=>{var A,B;return((A=O.tableOptions)==null?void 0:A[Y])!==((B=s.tableOptions)==null?void 0:B[Y])});return{name:e,collationOptions:S?{defaultCharSet:(y=s.tableOptions)==null?void 0:y.defaultCharSet,characterSet:(P=s.tableOptions)==null?void 0:P.characterSet,collation:(C=s.tableOptions)==null?void 0:C.collation}:null}}})};
